CMAKE_MINIMUM_REQUIRED(VERSION 3.10.3)

SET(SRC_DIR ${CONCRETE_PROJECT_ROOT_DIRECTORY}src)

CONCRETE_METHOD_SOURCE_DIRECTORY_ANALYSE(
    HDC ${SRC_DIR} 
    EXT h c asm
)

# common source group
CONCRETE_METHOD_SOURCE_LIST(
    HDC_COMMON_SOURCE_LIST
        SOURCES
            ${HDC_COMMON_SOURCES}
        SOURCES_FOLDER
            ${HDC_COMMON_DIR_NAME}
        MSVC_SOURCES 
            ${HDC_COMMON_WINDOWS_SOURCES}
        MSVC_SOURCES_FOLDER
            ${HDC_COMMON_WINDOWS_DIR_NAME}
)

# cpuid source group
CONCRETE_METHOD_SOURCE_LIST(
    HDC_CPUID_SOURCE_LIST
        SOURCES 
            ${HDC_CPUID_SOURCES}
        SOURCES_FOLDER
            ${HDC_CPUID_DIR_NAME}
        MSVC_SOURCES 
            ${HDC_CPUID_WINDOWS_MASM_SOURCES}
        MSVC_SOURCES_FOLDER
            ${HDC_CPUID_WINDOWS_MASM_DIR_NAME}
)

# smbios source group
CONCRETE_METHOD_SOURCE_LIST(
    HDC_SMBIOS_SOURCE_LIST
        SOURCES 
            ${HDC_SMBIOS_SOURCES}
        SOURCES_FOLDER
            ${HDC_SMBIOS_DIR_NAME}
        MSVC_SOURCES 
            ${HDC_SMBIOS_WINDOWS_SOURCES}
        MSVC_SOURCES_FOLDER
            ${HDC_SMBIOS_WINDOWS_DIR_NAME}
)

CONCRETE_METHOD_ADD_TARGET(
    TARGET_NAME 
        libhdc
    TYPE        
        "Static"
    SOURCES
        ${HDC_COMMON_SOURCE_LIST}
        ${HDC_CPUID_SOURCE_LIST}
        ${HDC_SMBIOS_SOURCE_LIST}
    INCLUDE_DIRECTORIES
        PUBLIC
            ${SRC_DIR}
)

IF(MSVC)
    SET_SOURCE_FILES_PROPERTIES(
        ${SRC_DIR}/cpuid/windows/masm/cpuid.asm
        PROPERTIES
            COMPILE_FLAGS "/safeseh /Fo$(IntDir)cpuid.asm.obj"
    )
ENDIF(MSVC)